<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=11">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="notify.js"></script>
    <title>Handling 编辑器</title>
	<style>
	.border h3 {
		margin-top: 16px;
	}
	.border > .border h3 {
		margin-top: unset;
	}
	#modelFlagsSection .border .py-1, #handlingFlagsSection .border .py-1 {
		cursor: pointer;
	}
	#modelFlagsSection .border .py-1:hover, #handlingFlagsSection .border .py-1:hover {
		background: rgba(0,0,0,0.05);
	}
	.margin-bottom-16 {
		margin-bottom: 16px;
	}
	</style>
</head>
<body>
    <div>
        <small class="float-right px-1 text-muted">0.3.5 - Added mass comparer</small><br>
        <div class="text-center">
            <span class="display-4">Handling 编辑器</span><br>
            <span class="mt-2">在线轻松编辑你的 Handling 文件</span>
        </div>
    </div>

    <div class="container px-5" style="max-width:1500px">
        <div class="py-5 w-50 mx-auto">

            <p>这个工具主要用于提供一个可视化的界面来对 Handling 文件进行修改，方便初学者了解如何修改车辆的数据文件。</p>
            <p>你可以从头开始，通过移动滑块来调整参数，完成后只需要按下保存按钮即可下载编辑好的 Handling 文件，不要忘了用记事本打开并修改 Handling 的 ID。</p>
            <p class="text-center mt-5">你也可以在下方加载自定义的 Handling 文件。</p>
            <div class="d-flex justify-content-around">

                <div class="">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input " id="handlingFileLoader" accept=".meta,.xml">
                        <label class="custom-file-label" for="handlingFileLoader">选择一个 Handling 文件</label>
                    </div>
                </div>

            </div>

            <div class="text-center mt-2">
                <a name="" onfocus="UpdateFileObject()" id="savefile" class="btn btn-primary btn " href="#"
                    role="button">保存当前文件</a>
            </div>
            <div class="d-flex align-content-center mt-2">
            </div>
        </div>
    </div>

    <!-- Alert in case the user does not load a handling file but tries to edit the values -->
    <div class="alert alert-warning alert w-25 mx-auto text-center d-none" role="alert" id="wEmptyFile">请先加载一个 Handling 文件</div>

    <div class="container-fluid border py-2 px-5 mb-5" style="max-width:1500px">
        <!-- Tab links -->
        <ul class="nav nav-tabs justify-content-center">

            <li class="nav-item">
                <a class="nav-link active show" data-toggle="tab" id="aero-tab" href="#aero">空气动力</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="chassis-tab" href="#chassis">车身</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="engine-tab" href="#engine">引擎</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="transmission-tab" href="#transmission">传动系统</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="brakes-tab" href="#brakes">刹车</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="traction-tab" href="#traction">牵引力</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="suspension-tab" href="#suspension">悬挂</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="antiroll-tab" href="#antiroll">防倾杆</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="flags-tab" href="#flags">Flags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="raw-tab" href="#raw">原始数据</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="measurements-tab" href="#measurements">单位</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="comparer-tab" href="#comparer">数据比较</a>
            </li>
        </ul>
        <!-- Tabs Holder -->
        <div class="container-fluid tab-content " id="myTabContent">
            <!-- Tab items -->
            <div class="pb-5  tab-pane fade active show " id="aero" role="tabpanel" aria-labelledby="aero-tab">

                <div class="row pb-4 px-3">

                    <div class="border mt-3">
                        <h3 class="text-center py-1">空气动力</h3>
                        <p class="px-5 text-center">这些数值代表车辆的空气动力学相关参数，会影响车辆的最高速度</p>
                        <hr>
                        <div class="d-flex align-content-around px-3">
                            <div class="w-50 p-5">
                                <div class="bg-light border border-rounded p-4">
                                    <h3 class="text-center">下压力</h3>
                                    <p class="text-muted text-center">fDownforceModifier</p>
                                    <canvas id="downforceChart" width="100" height="50"></canvas>
                                    <div class="d-flex align-content-center">
                                        <span>0</span>
                                        <input type="range" min="0" max="5" value="1" step="0.05"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="fDownforceModifierSlider" oninput="applyValueChange(this)"
                                            name="fDownforceModifier">
                                        <span>5</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this)" name="fDownforceModifier"
                                        class="form-control text-center my-2" step="0.005" id="fDownforceModifierInput">


                                    <p class="text-center">车辆将会在速度超过 100km/h 的时候产生额外的 <span id="fDownforceModifierExpl"
                                            class="text-danger">d</span>G 抓地力</p>
                                    <hr>

                                    <p>下压力是一种提高抓地力的方法，可以通过尾翼增加下压力。</p>
                                    <p>在 GTA5 中，下压力表示为两种行为-实际将汽车向下压的下压力，以及基于fDownforceModifier和规则集的单独抓地力。<br><br>
									将结果值添加到车轮抓地力，再乘以车轮数量（通常是 4 个）。</p>
                                    <hr>
                                    <p>fDownforceModifier 的值可以定义为以下三个压力计算的设定之一：
                                        <li>
                                            <b>动态</b>：介于 1.0 到 100。车辆会动态增加抓地力，静止状态时为 0，达到 90% 的最高速度时为 fDownforceModifier 的值乘以 0.035。
                                        </li>
                                        <li>
                                            <b>静态 (高)</b>: 1.0 或更小。车辆会产生 0.035 的平面抓地力，如果改装了尾翼，则为 0.07。
                                        </li>
                                        <li>
                                            <b>静态 (低)</b>: 100 或更多。车辆会产生 0.0105 的平面抓地力，如果改装了尾翼，则为 0.01313。
                                        </li>
                                    </p>
                                    <p>自动尾翼车辆会忽略这个设定，当尾翼升高的时候会设置为 0.035，刹车时会设定为 0.07</p>
                                    <hr>
                                    <p>在方程式赛车上有第四个设定，这个设定需要高级 Flag 并定义每个保险杠/风刀/尾翼的指定数值，目前还在研究中。</p>

                                </div>
                            </div>
                            <div class="w-50 p-5">
                                <div class="bg-light border border-rounded p-4">
                                    <h3 class="text-center">空气阻力</h3>
                                    <p class="text-muted text-center">fInitialDragCoeff</p>
                                    <canvas id="airdragChart" width="100" height="50"></canvas>

                                    <div class="d-flex align-content-center">
                                        <span>0</span>
                                        <input type="range" min="1" max="20" value="7" step="0.5"
                                            id="fInitialDragCoeffSlider" oninput="applyValueChange(this)"
                                            class="form-control-range w-100 mx-2 custom-range" name="fInitialDragCoeff">
                                        <span>20</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this)" name="fInitialDragCoeff"
                                        class="form-control text-center my-2" step="0.05" id="fInitialDragCoeffInput">
                                    <p>车辆的车身空气阻力。
                                    </p>
                                    <p>较高的阻力意味着在高速行驶的情况下，动力损失会更加明显，从而降低最高速度，因为发动机无法抵消该作用力。较低的空气阻力可以让车辆在同样马力的情况下开的更快。</p>

                                    <p>这个数值乘以速度即可得到风阻，数值越大，高速行驶的时候空气阻力就越大。</p>
                                    <!--
                                    <div class="alert alert-warning mt-3" role="alert">This value does not yet simulate
                                        torque falloff at the end of the gear, so it is innacurate. It will show a top
                                        speed lower than the ingame top speed.</div>-->
                                    <div class="pl-5 font-italic">
                                        <li>扭矩和阻力之间的关联并不是很强，当车辆行驶在下坡路段或者改装了性能之后可以轻松超过此速度，虽然提升不是很多。</li>
                                        <li>阻力和扭矩相反，两者均以 G 力为单位进行计算，它们的平均值就是车辆的最高速度。</li>
                                        <li>和下压力不同，阻力的作用是全方向的。</li>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="pb-5  tab-pane fade " id="chassis" role="tabpanel" aria-labelledby="chassis-tab">

                <div class="row pb-4 px-3">
                    <div class="border mt-3">
                        <h3 class="text-center py-1">车身</h3>
                        <p class="px-5 text-center">这些数值代表车辆的主体物理设定，并将对车辆的运动行为起到很大的作用。</p>
                        <hr>

                        <div class="row px-3">
                            <div class="col-md-4">
                                <div class="bg-light border border-rounded p-4">
                                    <h3 class="text-center">重量</h3>
                                    <p class="text-muted text-center">fMass</p>
                                    <div class="d-flex align-content-center">
                                        <span>0</span>
                                        <input type="range" min="0" max="15000" value="1000"
                                            class="form-control-range w-100 mx-2 custom-range" id="fMassSlider"
                                            oninput="applyValueChange(this)" name="fMass">
                                        <span>15000</span>
                                    </div>
                                    <div class="mb-4">
                                        <div class="text-center" style="min-height:50px">
                                            <input type="number" oninput="applyValueChange(this)" name="fMass"
                                                id="fMassInput" class="form-control text-center my-2">
                                            <small class="d-none">你的车将会有 <span
                                                    class="text-danger">1000</span>kg 重</small>
                                        </div>
                                    </div>
                                    <p>以 Kg 千克为单位，这个重量只在实体之间互相碰撞时产生效果。</p>
                                    <p>重量与车辆的操作手感没有任何关系，也完全不影响汽车的性能。只影响汽车在与其他实体碰撞时的情况。其他车辆、灯柱、石头等。</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="bg-light border border-rounded p-4">

                                    <h3 class="text-center">重心偏移</h3>
                                    <p class="text-muted text-center">vecCentreOfMassOffset X</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="0" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecCentreOfMassOffset__XSlider" oninput="applyValueChange(this, 'x')"
                                            name="vecCentreOfMassOffset__X">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'x')" name="vecCentreOfMassOffset__X"
                                        class="form-control text-center my-2" step="0.001" value="0.0"
                                        id="vecCentreOfMassOffset__XInput">
										
									<p class="text-muted text-center">vecCentreOfMassOffset Y</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="0" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecCentreOfMassOffset__YSlider" oninput="applyValueChange(this, 'y')"
                                            name="vecCentreOfMassOffset__Y">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'y')" name="vecCentreOfMassOffset__Y"
                                        class="form-control text-center my-2" step="0.001" value="0.0"
                                        id="vecCentreOfMassOffset__YInput">
									
									<p class="text-muted text-center">vecCentreOfMassOffset Z</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="0" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecCentreOfMassOffset__ZSlider" oninput="applyValueChange(this, 'z')"
                                            name="vecCentreOfMassOffset__Z">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'z')" name="vecCentreOfMassOffset__Z"
                                        class="form-control text-center my-2" step="0.001" value="0.0"
                                        id="vecCentreOfMassOffset__ZInput">
                                    <p>这些数值指定了车身重心的偏移量，X 表示左右，Y 表示前后，Z 表示上下。</p>
									<p>如果发现某些车辆容易侧翻，可以尝试降低 Z 值，负数也可以。</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="bg-light border border-rounded p-4">
                                    <h3 class="text-center">旋转惯性</h3>
                                    <p class="text-muted text-center">vecInertiaMultiplier X</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="1.4" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecInertiaMultiplier__XSlider" oninput="applyValueChange(this, 'x')"
                                            name="vecInertiaMultiplier__X">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'x')" name="vecInertiaMultiplier__X"
                                        class="form-control text-center my-2" step="0.001" value="1.4"
                                        id="vecInertiaMultiplier__XInput">
									
									<p class="text-muted text-center">vecInertiaMultiplier Y</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="1.4" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecInertiaMultiplier__YSlider" oninput="applyValueChange(this, 'y')"
                                            name="vecInertiaMultiplier__Y">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'y')" name="vecInertiaMultiplier__Y"
                                        class="form-control text-center my-2" step="0.001" value="1.4"
                                        id="vecInertiaMultiplier__YInput">
									
									<p class="text-muted text-center">vecInertiaMultiplier Z</p>

                                    <div class="d-flex align-content-center">
                                        <span>-4</span>
                                        <input type="range" min="-4" max="4" value="1.6" step="0.01"
                                            class="form-control-range w-100 mx-2 custom-range"
                                            id="vecInertiaMultiplier__ZSlider" oninput="applyValueChange(this, 'z')"
                                            name="vecInertiaMultiplier__Z">
                                        <span>4</span>
                                    </div>
                                    <input type="number" oninput="applyValueChange(this, 'z')" name="vecInertiaMultiplier__Z"
                                        class="form-control text-center my-2" step="0.001" value="1.6"
                                        id="vecInertiaMultiplier__ZInput">
                                    <p>这些数值表示车辆在转弯时候的惯性系数，数值越大，在对应方向上移动的时候加速就越慢。</p>
									<p>X 表示横向移动，Y 表示前进和后退，Z 表示左右转向，适当的给漂移车增加 Z 值可以提高稳定性。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-5  tab-pane fade" id="engine" role="tabpanel" aria-labelledby="engine-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">引擎</h3>
                    <p class="px-5 text-center">引擎是让你的车辆动起来的关键，这些数值控制着发动机不同部分的细节。
                        <br>这些数值与变速箱有很大关联。</p>

                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">动力 / 加速能力</h3>
                                <p class="text-muted text-center">fInitialDriveForce</p>
                                <canvas id="powerChart" width="100" height="75" class="mx-auto"></canvas>

                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" name="fInitialDriveForce" type="range"
                                        value="0.3" step="0.005" min="0" max="0.5" oninput="applyValueChange(this)"
                                        id="fInitialDriveForceSlider">
                                    <span>0.5</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="0.3" step="0.001"
                                    oninput="applyValueChange(this) " id="fInitialDriveForceInput"
                                    name="fInitialDriveForce">
                                <!-- <p class=" text-center">Acceleration: <span class="text-danger"
                                        id="fInitialDriveForceExpl"></span> mph per second in 1º gear.</p>-->
                                <p>也叫马力，它决定了发动机的目标加速度，以 G 力为单位。但是车轮的抓地力可能无法承受过大的动力。</p>
                                <p>变速箱按照比例调节这个数值，将其转换为扭矩，成为车辆的最终加速度。</p>
                                <hr>
                                <p>电动车不会按照此数值计算，初始扭矩为 x5 倍，在达到最高速度时变为 x1。</p>

                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">飞轮惯性</h3>
                                <p class="text-muted text-center">fDriveInertia</p>


                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0"
                                        max="3" oninput="applyValueChange(this)" id="fDriveInertiaSlider"
                                        name="fDriveInertia">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number"
                                    oninput="applyValueChange(this)" step="0.001" id="fDriveInertiaInput"
                                    name="fDriveInertia">
                                <p class=" text-center">引擎转速可以在 <span class="text-danger" id="fDriveInertiaExpl"></span>s 内从怠速升高到红线</p>
                                <hr>
                                <p>这个数值控制了发动机的油门响应速度，较高的数值意味着转速更快到达红线，较低的数值则相反。</p>
                                <p>它的原理和现实中的发动机飞轮类似，比较轻的飞轮可以对发动机转速变化做出更快的反应，而较重的飞轮则会慢一些，同时转速下降也会慢一些。</p>
                            </div>

                        </div>

                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">

                                <h3 class="text-center">最高速度</h3>
                                <p class="text-muted text-center">fInitialDriveMaxFlatVel</p>

                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="100" step="1" min="0"
                                        max="360" oninput="applyValueChange(this)" id="fInitialDriveMaxFlatVelSlider"
                                        name="fInitialDriveMaxFlatVel">
                                    <span>360</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fInitialDriveMaxFlatVelInput"
                                    name="fInitialDriveMaxFlatVel">
                                <p class="text-center">车辆在最高档位的时候可以达到 <span class="text-danger"
                                        id="fInitialDriveMaxFlatVelExpl">40</span> mph</p>
                                <hr>

                                <p>引擎所能达到的最高速度，超过这个速度以后发动机功率会大幅度降低。</p>
                                <p>变速箱会影响车辆最高速度，因此车辆不一定能完全达到这个速度。</p>
								<p>漂移车请始终保持这个数值为 360（拉到最大）。</p>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-5 tab-pane fade" id="transmission" role="tabpanel" aria-labelledby="transmission-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">传动系统</h3>
                    <p class="px-5 text-center">变速箱配合引擎来决定车辆的最终动力输出</p>
                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">

                                <h3 class="text-center">档位数量</h3>
                                <p class="text-muted text-center">nInitialDriveGears</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="6" step="1" min="0"
                                        max="6" oninput="applyValueChange(this)" id="nInitialDriveGearsSlider"
                                        name="nInitialDriveGears">
                                    <span>6</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="1"
                                    oninput="applyValueChange(this) " id="nInitialDriveGearsInput"
                                    name="nInitialDriveGears">
                                <p>车辆在原厂状态下有多少个档位。</p>
                                <hr>
                                <p>模拟齿轮，根据 <i>fInitialDriveForce</i> 来加速到
                                    <i>fInitialDriveMaxFlatVel</i>，建议设置合理的档位来达到最高速度。</p>

                                <p>在改车王升级变速箱会增加一个档位。</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">换挡时间</h3>
                                <p class="text-muted text-center">fClutchChangeRateScaleUpShift</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.25" min="0.0"
                                        max="10" oninput="applyValueChange(this)"
                                        id="fClutchChangeRateScaleUpShiftSlider" name="fClutchChangeRateScaleUpShift">
                                    <span>10</span>
                                </div>
                                <input class="form-control text-center my-2" type="number"
                                    oninput="applyValueChange(this)" step="0.05" id="fClutchChangeRateScaleUpShiftInput"
                                    name="fClutchChangeRateScaleUpShift">
                                <p class=" mx-auto text-center">车辆需要 <span class="text-danger"
                                        id="fClutchChangeRateScaleUpShiftExpl"></span>s 来换挡</p>
                                <hr>
                                <p></p>
                                <p class="text-muted text-center">fClutchChangeRateScaleDownShift</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.25" min="0.0"
                                        max="10" oninput="applyValueChange(this)"
                                        id="fClutchChangeRateScaleDownShiftSlider"
                                        name="fClutchChangeRateScaleDownShift">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number"
                                    oninput="applyValueChange(this)" step="0.05"
                                    id="fClutchChangeRateScaleDownShiftInput" name="fClutchChangeRateScaleDownShift">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">动力分配</h3>
                                <p class="text-muted text-center">fDriveBiasFront</p>

                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.05" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fDriveBiasFrontSlider"
                                        name="fDriveBiasFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fDriveBiasFrontInput" name="fDriveBiasFront">
                                <p>这个数值用于定义要分配多少动力给前轮，数值越大，分配给前轮的动力越多。</p>
                                <p>0.0 表示完全后轮驱动，0.5 为四轮驱动，1.0 为前轮驱动。</p>


                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="pb-5 tab-pane fade" id="brakes" role="tabpanel" aria-labelledby="brakes-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">刹车</h3>
                    <p class="px-5 text-center">刹车也是决定车辆性能的主要因素之一。<br>刹车通常是配合动力以及抓地力来修改的，建议让这些数值保持平衡以获得最佳的操作手感。
                        <br>当然你也可以随便修改……</p>

                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">刹车力度</h3>
                                <p class="text-muted text-center">fBrakeForce</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0.1"
                                        max="1" oninput="applyValueChange(this)" id="fBrakeForceSlider"
                                        name="fBrakeForce">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.01"
                                    oninput="applyValueChange(this) " id="fBrakeForceInput" name="fBrakeForce">
                                <p class="text-center">车辆从 100 减速到 0km/h 大约要 <span class="text-danger"
                                        id="fBrakeForceExpl"></span>s</p>
                                <p>这个数值决定了刹车时要给每个轮子分配多大的 G 力。</p>
                                <hr>

                                <p>
                                    <i>fTractionCurveMax</i> 和 <i>fBrakeForce</i> 密切相关。假设两个数值完美平衡，25% 的刹车力度足以使每个轮子抱死。
                                </p>

                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">刹车分配</h3>
                                <p class="text-muted text-center">fBrakeBiasFront</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.025" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fBrakeBiasFrontSlider"
                                        name="fBrakeBiasFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fBrakeBiasFrontInput" name="fBrakeBiasFront">

                                <p class="text-center"><span class="" id="fBrakeBiasFrontExpl"></span></p>
                                <p>这个数值决定了刹车时要分配多少的力度给前轮</p>
                                <p>
                                    通常来说最佳平衡点位于 0.55 到 0.7 之间，刹车效果最佳，因为它考虑了刹车后的重心转移。<br><br>车身倾斜比较严重的车辆通常需要让前轮刹车力度大一些。
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">手刹力度</h3>
                                <p class="text-muted text-center">fHandBrakeForce</p>

                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.05" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fHandBrakeForceSlider"
                                        name="fHandBrakeForce">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fHandBrakeForceInput" name="fHandBrakeForce">
                                <p>和刹车力度 <i>fBrakeForce</i>一样，但是仅作用于后轮。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-5 tab-pane fade" id="traction" role="tabpanel" aria-labelledby="traction-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">牵引力</h3>
                    <p class="px-5 text-center">牵引力（抓地力）是限制动力和刹车的主要方法，必须能同时限制二者，否则车辆可能会发生车轮打滑或抱死。
                        <br>当然，这些也可以看成是特性而不是缺点，例如漂移车往往需要较低的抓地力来实现漂移。</p>
                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">轮胎牵引力</h3>
                                <p class="text-muted text-center">fTractionCurveMax</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.05" min="0"
                                        max="3" oninput="applyValueChange(this)" id="fTractionCurveMaxSlider"
                                        name="fTractionCurveMax">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.025"
                                    oninput="applyValueChange(this) " id="fTractionCurveMaxInput"
                                    name="fTractionCurveMax">
                                <hr>
                                <p class="text-muted text-center">fTractionCurveMin</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.05" min="0"
                                        max="3" oninput="applyValueChange(this)" id="fTractionCurveMinSlider"
                                        name="fTractionCurveMin">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.025"
                                    oninput="applyValueChange(this) " id="fTractionCurveMinInput"
                                    name="fTractionCurveMin">
                                <p>车轮能够牵引的最大和最小 G 力。</p>
                                <hr>
                                <p>在 GTA5 中，抓地力表示车辆轮胎能够加速或减速车辆的能力。这些值会随着环境的变化而不断改变，比如悬挂压力、当前轮胎行驶的路面材质等等。<br><br>
								对于漂移车来说，通常使用的数据是 0.84 Max，1.45 Min，车辆会拥有不错的提速能力。
								</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">牵引力曲线</h3>
                                <p class="text-muted text-center">fTractionCurveLateral</p>
                                <div class="d-flex align-content-center">
                                    <span>10</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.5" min="10"
                                        max="30" oninput="applyValueChange(this)" id="fTractionCurveLateralSlider"
                                        name="fTractionCurveLateral">
                                    <span>30</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.25" type="number"
                                    oninput="applyValueChange(this)" id="fTractionCurveLateralInput"
                                    name="fTractionCurveLateral">
                                <p>设定角度可以让车辆得到最佳的抓地力。</p>
                                <hr>
                                <p>车辆通常会保持在该数值的一半以下。</p>
                                <p>对于大多数车辆来说，建议保持在 22.5，运动跑车和超级跑车可以设置为 18º，让它更直。除了一些老旧的肌肉车外，不建议超过 24º。
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">牵引力分配</h3>
                                <p class="text-muted text-center">fTractionBiasFront</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range " type="range" value="0" step="0.005" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fTractionBiasFrontSlider"
                                        name="fTractionBiasFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.005" type="number"
                                    oninput="applyValueChange(this)" id="fTractionBiasFrontInput"
                                    name="fTractionBiasFront">
                                <p class="text-center">抓地力平衡：<br> <span class="text-primary"
                                        id="fTractionBiasFrontExpl"></span></p>
                                <hr>
                                <p>这个数值完美地模拟了前后轴安装了不同类型车轮的情况，例如不同的材料，不同的宽度。它决定了要分配多少抓地力给前轮。<br><br>
								对于漂移车来说可以有效解决推头和甩尾的问题，通常推荐在 0.46 - 0.48 之间，数值越大越容易 spin。</p>
                            </div>
                        </div>
                    </div>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">越野牵引力</h3>
                                <p class="text-muted text-center">fTractionLossMult</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0"
                                        max="1.5" oninput="applyValueChange(this)" id="fTractionLossMultSlider"
                                        name="fTractionLossMult">
                                    <span>1.5</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="1"
                                    oninput="applyValueChange(this) " id="fTractionLossMultInput"
                                    name="fTractionLossMult">
                                <p>设定当车辆行驶在非水泥和柏油路上时会损失多少抓地力。</p>
                                <p>正常来说是 1.0，如果低于 1.0 时，损失的抓地力会较小，大于 1.0 时，损失的抓地力会较大。
                                    <br><br>超级跑车通常会损失 1.5 左右的抓地力，请注意：过高的数值可能会产生负抓地力。
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">低速损失牵引力</h3>
                                <p class="text-muted text-center">fLowSpeedTractionLossMult</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range " type="range" value="0" step="0.05" min="0"
                                        max="2" oninput="applyValueChange(this)" id="fLowSpeedTractionLossMultSlider"
                                        name="fLowSpeedTractionLossMult">
                                    <span>2</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fLowSpeedTractionLossMultInput"
                                    name="fLowSpeedTractionLossMult">
                                <p>设置车辆在低速状态时会损失多少抓地力，可以模拟出大扭矩车辆起步烧胎的情况。</p>
								<p>请注意：过大的数值可能会导致负抓地力。</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">最大转向角度</h3>
                                <p class="text-muted text-center">fSteeringLock</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.05" min="0"
                                        max="75" oninput="applyValueChange(this)" id="fSteeringLockSlider"
                                        name="fSteeringLock">
                                    <span>75</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fSteeringLockInput" name="fSteeringLock">
                                <p>车辆的最大转向角度，常见漂移数据的转向角度都是 55 度左右，某些大角度数据可能会到 65 度，最高不超过 75 度。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-5 tab-pane fade" id="suspension" role="tabpanel" aria-labelledby="suspension-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">悬挂系统</h3>
                    <p class="px-5 text-center">悬挂对于车辆的操作手感起到很大的影响，太硬或者太软的悬挂都会造成漂移手感不佳。<br>因此合理设置悬挂可以让你的车更好开。</p>
                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">弹簧硬度</h3>
                                <p class="text-muted text-center">fSuspensionForce</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0"
                                        max="5" oninput="applyValueChange(this)" id="fSuspensionForceSlider"
                                        name="fSuspensionForce">
                                    <span>5</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="1"
                                    oninput="applyValueChange(this) " id="fSuspensionForceInput"
                                    name="fSuspensionForce">
                                <p>设置弹簧的硬度，通常在 1.5 到 2.5 之间，漂移车推荐较低的硬度以获得最佳的响应。</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">弹簧阻尼硬度</h3>
                                <p class="text-muted text-center">fSuspensionCompDamp</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.05" min="0"
                                        max="3" oninput="applyValueChange(this)" id="fSuspensionCompDampSlider"
                                        name="fSuspensionCompDamp">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.025"
                                    oninput="applyValueChange(this) " id="fSuspensionCompDampInput"
                                    name="fSuspensionCompDamp">
                                <hr>
                                <p class="text-muted text-center">fSuspensionReboundDamp</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.05" min="0"
                                        max="3" oninput="applyValueChange(this)" id="fSuspensionReboundDampSlider"
                                        name="fSuspensionReboundDamp">
                                    <span>3</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.025"
                                    oninput="applyValueChange(this) " id="fSuspensionReboundDampInput"
                                    name="fSuspensionReboundDamp">
                                <p>在压缩或者释放时候弹簧硬度的衰减程度。</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">弹簧高度限制</h3>
                                <p class="text-muted text-center">fSuspensionUpperLimit</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.005" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fSuspensionUpperLimitSlider"
                                        name="fSuspensionUpperLimit">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.0025"
                                    oninput="applyValueChange(this) " id="fSuspensionUpperLimitInput"
                                    name="fSuspensionUpperLimit">
                                <hr>
                                <p class="text-muted text-center">fSuspensionLowerLimit</p>
                                <div class="d-flex align-content-center">
                                    <span>-1</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.005" min="-1"
                                        max="0" oninput="applyValueChange(this)" id="fSuspensionLowerLimitSlider"
                                        name="fSuspensionLowerLimit">
                                    <span>0</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.0025"
                                    oninput="applyValueChange(this) " id="fSuspensionLowerLimitInput"
                                    name="fSuspensionLowerLimit">
                                <p>弹簧最多可以被压缩或者延长的长度，以米为单位，不建议数值过大，会导致车轮穿模。</p>
                            </div>
                        </div>
                    </div>
                    <div class="row pb-4 px-3">
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">悬挂高度提升</h3>
                                <p class="text-muted text-center">fSuspensionRaise</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.05" min="-1"
                                        max="1" oninput="applyValueChange(this)" id="fSuspensionRaiseSlider"
                                        name="fSuspensionRaise">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="0.025"
                                    oninput="applyValueChange(this) " id="fSuspensionRaiseInput"
                                    name="fSuspensionRaise">
                                <p>设定要将悬挂提高多少高度，默认为 0，以米为单位，负数可以降低车身。</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">弹簧硬度分配</h3>
                                <p class="text-muted text-center">fSuspensionBiasFront</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.005" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fSuspensionBiasFrontSlider"
                                        name="fSuspensionBiasFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.0025" type="number"
                                    oninput="applyValueChange(this)" id="fSuspensionBiasFrontInput"
                                    name="fSuspensionBiasFront">
                                <p>这个数值可以设定要分配多少弹簧硬度给前轮，数值越大分配越多，0.5 为前后平滑。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-5 tab-pane fade" id="antiroll" role="tabpanel" aria-labelledby="antiroll-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">防倾杆</h3>
                    <p class="px-5 text-center">防倾杆的主要作用是防止车辆在转弯时倾斜角度过大。<br>
                        车辆倾斜的车轮会由于压力获得更大的抓地力，而另一侧的车轮会失去抓地力。</p>
                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">防倾杆强度</h3>
                                <p class="text-muted text-center">fAntiRollBarForce</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0"
                                        max="2" oninput="applyValueChange(this)" id="fAntiRollBarForceSlider"
                                        name="fAntiRollBarForce">
                                    <span>2</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="1"
                                    oninput="applyValueChange(this) " id="fAntiRollBarForceInput"
                                    name="fAntiRollBarForce">
                                <p>设定防倾杆在防止车辆倾斜时的强度</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">防倾杆分配</h3>
                                <p class="text-muted text-center">fAntiRollBarBiasFront</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.05" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fAntiRollBarBiasFrontSlider"
                                        name="fAntiRollBarBiasFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fAntiRollBarBiasFrontInput"
                                    name="fAntiRollBarBiasFront">
                                <p>设定前轮的防倾杆要分配多少强度，数值越大分配越多，0.5 是前后平衡。</p>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row pb-4 px-3">
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">前倾斜中心点</h3>
                                <p class="text-muted text-center">fRollCentreHeightFront</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="1" step="0.001" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fRollCentreHeightFrontSlider"
                                        name="fRollCentreHeightFront">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" type="number" value="6" step="1"
                                    oninput="applyValueChange(this) " id="fRollCentreHeightFrontInput"
                                    name="fRollCentreHeightFront">
                                <p>这个数值相对于车辆模型底部，设定倾斜中心点在哪里。</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bg-light border border-rounded p-4">
                                <h3 class="text-center">后倾斜中心点</h3>
                                <p class="text-muted text-center">fRollCentreHeightRear</p>
                                <div class="d-flex align-content-center">
                                    <span>0</span>
                                    <input class="w-100 mx-2 custom-range" type="range" value="0" step="0.05" min="0"
                                        max="1" oninput="applyValueChange(this)" id="fRollCentreHeightRearSlider"
                                        name="fRollCentreHeightRear">
                                    <span>1</span>
                                </div>
                                <input class="form-control text-center my-2" step="0.01" type="number"
                                    oninput="applyValueChange(this)" id="fRollCentreHeightRearInput"
                                    name="fRollCentreHeightRear">
                                <p>这个数值相对于车辆模型底部，设定倾斜中心点在哪里。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
			
			<div class="pb-5 tab-pane fade" id="flags" role="tabpanel" aria-labelledby="flags-tab">
                <div class="border mt-3">
                    <h3 class="text-center py-1">Flags</h3>
                    <p class="px-5 text-center">Flags 主要用于控制车辆的行为和物理特性，不同的 Flags 组合可以获得特殊的操作手感。</p>
                    <hr>
					<div class="row pb-4 px-3">
						<div class="col-xl-6 text-center bg-whitesmoke mx-auto" id="modelFlagsSection">
							<!-- <div class="alert alert-secondary mx-5" role="alert"> -->
							<div class="text-center">
								<h3 class="text-center mt-3">模型行为 Flags</h3>
								<p class="text-muted text-center">strModelFlags</p>
							</div>
							<input id="modelFlagsForm" type="hidden" value="0" />
							<div id="table" class="border border-gray bg-light container-fluid" style="font-size: 14px;">
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">厢型车<br>IS_VAN</div>
									<div class="col-sm-3 py-1 align-middle">公交车<br>IS_BUS</div>
									<div class="col-sm-3 py-1 align-middle">低底盘车<br>IS_LOW</div>
									<div class="col-sm-3 py-1 align-middle">大型车<br>IS_BIG</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">防抱死系统<br>ABS_STD</div>
									<div class="col-sm-3 py-1 align-middle">可选防抱死<br>ABS_OPTION</div>
									<div class="col-sm-3 py-1 align-middle">替换防抱死系统<br>ABS_ALT_STD</div>
									<div class="col-sm-3 py-1 align-middle">可选替换防抱死<br>ABS_ALT_OPTION</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">没有车门<br>NO_DOORS</div>
									<div class="col-sm-3 py-1 align-middle">前后座椅<br>TANDEM_SEATS</div>
									<div class="col-sm-3 py-1 align-middle">坐在船里<br>SIT_IN_BOAT</div>
									<div class="col-sm-3 py-1 align-middle">具有轨道<br>HAS_TRACKS</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">没有排气管<br>NO_EXHAUST</div>
									<div class="col-sm-3 py-1 align-middle">两个排气管<br>DOUBLE_EXHAUST</div>
									<div class="col-sm-3 py-1 align-middle">第一人称不能向后看<br>NO1FPS_LOOK_BEHIND</div>
									<div class="col-sm-3 py-1 align-middle">没有车门时可以进入<br>CAN_ENTER_IF_NO_DOOR</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">前扭力梁悬挂<br>AXLE_F_TORSION</div>
									<div class="col-sm-3 py-1 align-middle">前直桥悬挂<br>AXLE_F_SOLID</div>
									<div class="col-sm-3 py-1 align-middle">前麦弗逊悬挂<br>AXLE_F_MCPHERSON</div>
									<div class="col-sm-3 py-1 align-middle">将人物附加到车身<br>ATTACH_PED_TO_BODYSHELL</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">后扭力梁悬挂<br>AXLE_R_TORSION</div>
									<div class="col-sm-3 py-1 align-middle">后直桥悬挂<br>AXLE_R_SOLID</div>
									<div class="col-sm-3 py-1 align-middle">后麦弗逊悬挂<br>AXLE_R_MCPHERSON</div>
									<div class="col-sm-3 py-1 align-middle">不强制清理地面<br>DONT_FORCE_GRND_CLEARANCE</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">不渲染转向动画<br>DONT_RENDER_STEER</div>
									<div class="col-sm-3 py-1 align-middle">车轮不会爆裂<br>NO_WHEEL_BURST</div>
									<div class="col-sm-3 py-1 align-middle">无敌载具<br>INDESTRUCTIBLE</div>
									<div class="col-sm-3 py-1 align-middle">两个前轮<br>DOUBLE_FRONT_WHEELS</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">遥控车<br>RC</div>
									<div class="col-sm-3 py-1 align-middle">两个后轮<br>DOUBLE_RWHEELS</div>
									<div class="col-sm-3 py-1 align-middle">车轮不会损坏<br>MF_NO_WHEEL_BREAK</div>
									<div class="col-sm-3 py-1 align-middle">掀背车<br>IS_HATCHBACK</div>
								</div>
							</div>
							<div class="border bg-light mt-2">
								<h3 class="margin-bottom-16">计算结果</h3>
								<div class="form-control mb-2 mt-2 mx-auto text-center border d-inline container-fluid">&lt;strModelFlags&gt;<span class="text-muted"><strong id="modelFlags">00000000</strong></span>&lt;&frasl;strModelFlags&gt;</div><br>
								<div class="alert alert-warning mx-5 mt-3 d-inline-block" role="alert">请注意，某些 flag 会被其他 flag 覆盖。<br>例如：<i>IS_BUS</i> 会覆盖 <i>IS_VAN</i>。</div>
							</div>
						</div>
						<div class="col-xl-6 text-center bg-whitesmoke mx-auto " id="handlingFlagsSection">
							<!-- <div class="alert alert-secondary mx-5" role="alert"> -->
							<div class="text-center">
								<h3 class="text-center mt-3">物理行为 Flags</h3>
								<p class="text-muted text-center">strHandlingFlags</p>
							</div>
							<input id="handlingFlagsForm" type="hidden" value="0" />
							<div id="table" class=" border border-gray bg-light container-fluid" style="font-size: 14px;">
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">平滑压缩<br>SMOOTH_COMPRESN</div>
									<div class="col-sm-3 py-1 align-middle">减少模型重量<br>REDUCED_MOD_MASS</div>
									<div class="col-sm-3 py-1 align-middle"></div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">没有手刹<br>NO_HANDBRAKE</div>
									<div class="col-sm-3 py-1 align-middle">后轮转向<br>STEER_REARWHEELS</div>
									<div class="col-sm-3 py-1 align-middle">后轮手刹和转向<br>HB_REARWHEEL_STEER</div>
									<div class="col-sm-3 py-1 align-middle">全轮转向<br>STEER_ALL_WHEELS</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">松油门时轮子空转<br>FREEWHEEL_NO_GAS</div>
									<div class="col-sm-3 py-1 align-middle">不能倒车<br>NO_REVERSE</div>
									<div class="col-sm-3 py-1 align-middle"></div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">无级变速箱<br>CVT</div>
									<div class="col-sm-3 py-1 align-middle">额外车轮边界<br>ALT_EXT_WHEEL_BOUNDS_BEH</div>
									<div class="col-sm-3 py-1 align-middle">高速时不提升边界<br>DONT_RAISE_BOUNDS_AT_SPEED</div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">减少雪地印记<br>LESS_SNOW_SINK</div>
									<div class="col-sm-3 py-1 align-middle">轮胎可以打滑<br>TYRES_CAN_CLI</div>
									<div class="col-sm-3 py-1 align-middle"></div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">越野车<br>OFFROAD_ABILITY</div>
									<div class="col-sm-3 py-1 align-middle">越野车2<br>OFFROAD_ABILITY2</div>
									<div class="col-sm-3 py-1 align-middle">提高侧边轮胎冲击<br>HF_TYRES_RAISE_SIDE_IMPACT_THRESHOLD</div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">启用 LEAN（未知）<br>ENABLE_LEAN</div>
									<div class="col-sm-3 py-1 align-middle">重装甲<br>HEAVYARMOUR</div>
									<div class="col-sm-3 py-1 align-middle"></div>
									<div class="col-sm-3 py-1 align-middle">装甲车<br>ARMOURED</div>
								</div>
								<div class="row">
									<div class="col-sm-3 py-1 align-middle">水中自动回正<br>SELF_RIGHTING_IN_WATER</div>
									<div class="col-sm-3 py-1 align-middle">更大的扶正力<br>IMPROVED_RIGHTING_FORCE</div>
									<div class="col-sm-3 py-1 align-middle"></div>
									<div class="col-sm-3 py-1 align-middle"></div>
								</div>
							</div>
							<div class="border bg-light mt-2">
								<h3 class="margin-bottom-16">计算结果</h3>
								<div class="form-control mb-2 mt-2 mx-auto text-center border  d-inline container-fluid">&lt;strHandlingFlags&gt;<span class="text-muted"><strong id="handlingFlags">00000000</strong></span>&lt;&frasl;strHandlingFlags&gt; </div><br>
								<div class="alert alert-warning mx-5 mt-3 d-inline-block" role="alert">请注意，某些 flag 会被其他 flag 覆盖。<br>例如：<i>STEER_REARWHEELS</i> 会覆盖 <i>STEER_ALL_WHEELS</i>。</div>
							</div>
						</div>
					</div>
				</div>
            </div>
			
            <div class="pb-5  tab-pane fade" id="raw" role="tabpanel" aria-labelledby="raw-tab">
                <div class="alert alert-warning mt-3" role="alert">不要在这里编辑数据，这个地方仅用于预览文件内容。</div>
                <textarea type="textarea" value="" id="handlingFileDisplay" style="min-height:1000px;"
                    class="mt-5 w-100 bg-light text-success" disabled></textarea>

            </div>

            <div class="pb-5  tab-pane fade" id="measurements" role="tabpanel" aria-labelledby="measurements-tab">

                <div class=" pb-4 px-3">

                    <div class="border mt-3">

                        <h3 class="text-center py-1">单位</h3>
                        <div class="px-5 mx-5">
                            <p>这个编辑器尝试将一些 handling 数据转换为真实的测量结果，并且以 <span class="text-danger">红色</span> 来显示它们。同时为了方便做参考和数值设定，这个页面记录并说明了用于获取游戏内数据单位的具体数字，乘数和算法等。</p>
							<p>然后编辑器根据这些标准来转换一些数值，例如 <span class="text-danger">mph</span>。</p>
                            <small class="float-right px-1 text-muted">
                                <span class="text-primary"><i>速度</i></span> 以 m/s 为单位。
                            </small>
                        </div>
                        <div class="mx-5">

                            <table class="table border">
                                <thead>
                                    <tr>
                                        <th scope="col">Handling 类型</th>
                                        <th scope="col">文件单位</th>
                                        <th scope="col">游戏单位</th>
                                        <th scope="col">公式</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>fInitialDriveForce</td>
                                        <td>加速度 (G 力)</td>
                                        <td>加速度 (G 力)</td>
                                        <td class="text-primary">fInitialDriveForce * 当前档位传动比</td>
                                    </tr>
                                    <tr>
                                        <td>fDownforceModifier</td>
                                        <td>乘数</td>
                                        <td>抓地力提高 (G 力)</td>
                                        <td class="text-primary">(0 - 0.035) > (fInitialDriveMaxFlatVel 的 0 - 90%)<br>*
                                            fDownforceModifier * 车轮数量</td>
                                    </tr>
                                    <tr>
                                        <td>fInitialDragCoeff</td>
                                        <td>乘数</td>
                                        <td>空气阻力 (G 力)</td>
                                        <td class="text-primary">(速度 * (fInitialDragCoeff * 0.0001))^2</td>
                                    </tr>
                                    <tr>
                                        <td>fDriveInertia</td>
                                        <td>乘数</td>
                                        <td>秒</td>
                                        <td class="text-primary"> 1 / fDriveInertia</td>
                                    </tr>
                                    <tr>
                                        <td>fInitialDriveMaxFlatVel</td>
                                        <td>速度</td>
                                        <td>公里每小时</td>
                                        <td class="text-primary">fInitialDriveMaxFlatVel / 0.75</td>
                                    </tr>
                                    <tr>
                                        <td>fClutchChangeRateScaleUpShift</td>
                                        <td>乘数</td>
                                        <td>秒</td>
                                        <td class="text-primary">1 / fClutchChangeRateScaleUpShift</td>
                                    </tr>
                                    <tr>
                                        <td>fBrakeForce</td>
                                        <td>每个车轮的减速能力 (G 力)</td>
                                        <td>每个车轮的减速能力 (G 力)</td>
                                        <td class="text-primary">速度 / (fBrakeForce * 车轮数量)</td>
                                </tbody>
                            </table>
                            <div class="alert alert-info w-50 mx-auto" role="alert">
                                大多数新的数字都是用 SHVDN 从游戏内存中提取的，例如每个轮子的扭矩。所有数据都在我的游戏里测试过，你可以在你的游戏中随意测试你的数据。
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pb-5  tab-pane fade" id="comparer" role="tabpanel" aria-labelledby="comparer-tab">

                <div class=" pb-4 px-3">

                    <div class="border mt-3">

                        <h3 class="text-center py-1">数据比较</h3>
                        <div class="w-50 mx-auto">
                            <p>这个简单的工具将会显示你输入的任何 handling 文件所定义的性能值，以便用于比较，它和本网页其他部分无关，也不会对你编辑的数据产生改动。</p>
                            <div class="mx-5 mb-1">
                                <div class="row">
                                    <div class="col">
                                        <label for="masscomparerloader">选择一个 handling 文件</label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input " id="masscomparerloader"
                                                multiple accept=".meta,.xml">
                                            <label class="custom-file-label" for="masscomparerloader">选择文件</label>
											<small id="searchHelp" class="form-text text-muted">也支持同时选择多个文件</small>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <form class="mx-auto">
                                            <div class="form-group">
                                                <label for="search">输入过滤器</label>
                                                <input type="text" oninput="filterComparerTable(this)" id="searchInput"
                                                    class="form-control">
                                                <small id="searchHelp" class="form-text text-muted">只显示指定的模型，例如：fds1452,s14,s15</small>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="mx-5">
                            <small class="float-right px-1 text-muted">
                                <i>可以通过点击表头来排序</i>
                            </small>
                            <table id="tablecompare" class="table w-75 mx-auto border">
                                <thead>
                                    <tr class="bg-light">
                                        <th scope="col" onclick="sortTable(0)">ID</th>
                                        <th scope="col" onclick="sortTable(1)">fInitialDriveForce</th>
                                        <th scope="col" onclick="sortTable(2)">nInitialDriveGears</th>
                                        <th scope="col" onclick="sortTable(3)">fInitialDriveMaxFlatVel</th>
                                        <th scope="col" onclick="sortTable(4)">fInitialDragCoeff</th>
                                        <th scope="col" onclick="sortTable(5)">fBrakeForce</th>
                                        <th scope="col" onclick="sortTable(6)">fTractionCurveMax</th>
                                        <th scope="col" onclick="sortTable(7)">fDownforceModifier</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodycompare" style="min-height: 500px;">
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>EXAMPLE</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                        <td>0.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-light border">
                <h3 class="text-center">比较器</h3>
                <hr>
                <div class="w-25 mx-auto mb-5">
                    <p>你可以在这里上传另一个 handling 文件，用于和当前编辑的 handling 做比较。</p>
                    <div class="custom-file">

                        <input type="file" class="custom-file-input" id="compparisonHandlingFileLoader" accept=".meta,.xml">
                        <label class="custom-file-label" for="compparisonHandlingFileLoader">选择 handling 文件...</label>
                    </div>
                    <p class="mt-2">编辑器支持直接从 OpenIV 里拖放文件</p>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h3 class="text-center">基本数据</h3>
                        <p class="text-center">主要数据计算，转换为 0 - 100 分。</p>
                        <canvas id="statsChart" width="100" height="50" class="mx-auto"></canvas>
                    </div>

                    <div class="col-md-6">
                        <h3 class="text-center">性能等级</h3>
                        <p class="text-center">
                            当前车辆：$<span class="text-danger" id="currentPrice"></span>，对比车辆：$<span class="text-primary" id="compPrice"></span>
                        </p>

                        <canvas id="piChart" width="100" height="50" class="mx-auto px-2"></canvas>
                    </div>
                </div>

            </div>
            <pre id="handlingArray" class="bg-info border d-none"></pre>
            <footer class="my-5">
                <p class="text-center bg-light border py-3">使用了
                    <strong>Bootstrap</strong>,
                    <strong>Charts.js</strong> 以及 <strong>Notify.js</strong> 构建 | 汉化 &amp; 修改 by <a href="https://github.com/kasuganosoras" target="_blank">Akkariin</a></p>
            </footer>
        </div>
</body>
<script>
	var modelFlags=document.querySelector("#modelFlagsSection").querySelectorAll(".row");
	var handlingFlags=document.querySelector("#handlingFlagsSection").querySelectorAll(".row");
	
	function autoborders() {
		var autoborder= document.querySelectorAll(".col-sm-3");
		for (var i = 0; i <= autoborder.length - 1; i++) {
			autoborder[i].onclick=toggle;
			$(autoborder[i]).toggleClass("border", true);
			$(autoborder[i]).toggleClass("text-truncate", true);
			$(autoborder[i]).toggleClass("border-gray", true);
		}
	}
	////////

	function toggle(e){
		if($(e.target).text() == "") return;
		$(e.target).toggleClass("bg-success");
		$(e.target).toggleClass("text-truncate");
		calcModelFlags();
		calcHandlingFlags();
	}
	
	function calcModelFlags(){
		var flagsfinal="";
		var arrayRows=document.querySelector("#modelFlagsSection").querySelectorAll(".row");
		arrayRows= $(arrayRows).toArray().reverse();
		var n=1;
		var m=1;
		var res=0;

		for (var a = 0; a <= arrayRows.length - 1; a++) {
			var columnas= arrayRows[a].querySelectorAll(".col-sm-3");
			n=1;
			m=1;
			res=0;
			for (var i = 0; i <= columnas.length - 1; i++) {
				if($(columnas[i]).hasClass("bg-success")){
					res += n*(m);
				}
				m*=2;
			}

			if(res==0)flagsfinal += "<span class='text-muted'>"+res.toString(16).toUpperCase()+"<span>";
			else flagsfinal += "<span class='text-success'>"+res.toString(16).toUpperCase()+"<span>";

			res=0;
		}
		document.getElementById('modelFlags').innerHTML=flagsfinal.toString();
		modelFlagsForm.value = document.getElementById('modelFlags').innerText;
		rawInput.value = rawInput.value.replace(new RegExp("(strModelFlags>)+[a-z.0-9-]*(<\/strModelFlags>)"), "strModelFlags>" + modelFlagsForm.value + "</strModelFlags>");
	}

	function calcHandlingFlags(){
		var flagsfinal="";
		var arrayRows=document.querySelector("#handlingFlagsSection").querySelectorAll(".row");
		arrayRows= $(arrayRows).toArray().reverse();
		var n=1;
		var m=1;
		var res=0;
		for (var a = 0; a <= arrayRows.length - 1; a++) {
		var columnas= arrayRows[a].querySelectorAll(".col-sm-3");
		n=1;
		m=1;
		res=0;
		for (var i = 0; i <= columnas.length - 1; i++) {
			if($(columnas[i]).hasClass("bg-success")){
				res += n*(m);	
			}
			m*=2;
		}
			if(res==0)flagsfinal += "<span class='text-muted'>"+res.toString(16).toUpperCase()+"<span>";
			else flagsfinal += "<span class='text-success'>"+res.toString(16).toUpperCase()+"<span>";
			res=0;
		}
		document.getElementById('handlingFlags').innerHTML=flagsfinal.toString();
		handlingFlagsForm.value = document.getElementById('handlingFlags').innerText;
		rawInput.value = rawInput.value.replace(new RegExp("(strHandlingFlags>)+[a-z.0-9-]*(<\/strHandlingFlags>)"), "strHandlingFlags>" + handlingFlagsForm.value + "</strHandlingFlags>");
	}
	
	window.onload=autoborders;
    var baseHandlingV = `<?xml version="1.0" encoding="UTF-8"?>
<CHandlingDataMgr>
  <HandlingData>
  <Item type="CHandlingData">
      <handlingName>输入 HANDLING 名字</handlingName>
      <fMass value="1500.000000" />
      <fInitialDragCoeff value="8.000000" />
      <fDownforceModifier value="1.000" />
      <fPercentSubmerged value="85.000000" />
      <vecCentreOfMassOffset x="0.000000" y="0.00000" z="0.000000" />
      <vecInertiaMultiplier x="1.400000" y="1.400000" z="1.600000" />
      <fDriveBiasFront value="0.000000" />
      <nInitialDriveGears value="6" />
      <fInitialDriveForce value="0.2000" />
      <fDriveInertia value="1.00000" />
      <fClutchChangeRateScaleUpShift value="2.00000" />
      <fClutchChangeRateScaleDownShift value="2.00000" />
      <fInitialDriveMaxFlatVel value="140.000000" />
      <fBrakeForce value="0.400000" />
      <fBrakeBiasFront value="0.60000" />
      <fHandBrakeForce value="0.60000" />
      <fSteeringLock value="35.000000" />
      <fTractionCurveMax value="2.300" />
      <fTractionCurveMin value="2.000" />
      <fTractionCurveLateral value="22.500000" />
      <fTractionSpringDeltaMax value="0.150000" />
      <fLowSpeedTractionLossMult value="0.500000" />
      <fCamberStiffnesss value="0.000000" />
      <fTractionBiasFront value="0.5000" />
      <fTractionLossMult value="1.000000" />
      <fSuspensionForce value="3.0000" />
      <fSuspensionCompDamp value="1.400000" />
      <fSuspensionReboundDamp value="1.400000" />
      <fSuspensionUpperLimit value="0.0750000" />
      <fSuspensionLowerLimit value="-0.0750000" />
      <fSuspensionRaise value="0.000000" />
      <fSuspensionBiasFront value="0.50000" />
      <fAntiRollBarForce value="0.450000" />
      <fAntiRollBarBiasFront value="0.500000" />
      <fRollCentreHeightFront value="0.30000" />
      <fRollCentreHeightRear value="0.30000" />
      <fCollisionDamageMult value="1.0000" />
      <fWeaponDamageMult value="1.000000" />
      <fDeformationDamageMult value="1.000000" />
      <fEngineDamageMult value="1.500000" />
      <fPetrolTankVolume value="65.000000" />
      <fOilVolume value="5.000000" />
      <fSeatOffsetDistX value="0.000000" />
      <fSeatOffsetDistY value="0.000000" />
      <fSeatOffsetDistZ value="0.000000" />
      <nMonetaryValue value="35000" />
      <strModelFlags>440010</strModelFlags>
      <strHandlingFlags>20000</strHandlingFlags>
      <strDamageFlags>0</strDamageFlags>
      <AIHandling>AVERAGE</AIHandling>
      <SubHandlingData>
        <Item type="NULL" />
        <Item type="NULL" />
        <Item type="NULL" />
      </SubHandlingData>
    </Item>
  </HandlingData>
</CHandlingDataMgr>`;
    var handlingFile = null;
    var rawInput = document.getElementById("handlingFileDisplay");

    rawInput.value = baseHandlingV;


    var handlingArray = {
        handling: {

        }
    }
    var comparisonHandlingArray = {
        handling: {

        }
    }
    //File save
    function UpdateFileObject() {
        var a = document.getElementById("savefile");
        var text = rawInput.value; //handlingFile.getElementsByTagName("CHandlingDataMgr")[0];
        var file = new Blob([text], { type: "text/xml" });

        a.href = URL.createObjectURL(file);
        a.download = "handling.meta";
    }

    //File load
    var input = document.getElementById("handlingFileLoader");
    input.addEventListener("change", function () {
        if (this.files && this.files[0]) {
            var myFile = this.files[0];
            var reader = new FileReader();
            reader.addEventListener('load', function (e) {
                //Parse the document. Copy all values in the document on to the sliders/inputs in the page
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(e.target.result, "text/xml");
                xmlDoc.getElementsByTagName("Item")[0].childNodes.forEach(element => {
                    if (element.attributes) {
                        var d = element.attributes[0];
                        if (d != null) {
                            var sld = document.getElementById(element.nodeName + "Slider");
                            if (sld != null) sld.value = d.value;
                            var input = document.getElementById(element.nodeName + "Input");
                            if (input != null) {
                                input.value = d.value;
                                UpdateExplanations(input);
                            }
                            handlingArray.handling[element.nodeName] = d.value;
                            updateArrayPre();
                            UpdateCharts();
                            $("#wEmptyFile").toggleClass("d-none", true);
                        }
                    }
                });
                //Copy the file's raw content to the raw input. We will do all our edits there.
                rawInput.value = e.target.result;
            });
            reader.readAsText(myFile);
            $.notify("File loaded.", "success");
        }
    });

    //Comparison file load   . 
    var input = document.getElementById("compparisonHandlingFileLoader");
    input.addEventListener("change", function () {
        if (this.files && this.files[0]) {
            var myFile = this.files[0];
            var reader = new FileReader();
            reader.addEventListener('load', function (e) {
                //Parse the document. Copy all values in the document on to the sliders/inputs in the page
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(e.target.result, "text/xml");
                xmlDoc.getElementsByTagName("Item")[0].childNodes.forEach(element => {
                    if (element.attributes) {
                        var d = element.attributes[0];
                        if (d != null) {
                            comparisonHandlingArray.handling[element.nodeName] = d.value;
                            UpdateCharts();
                            $("#wEmptyFile").toggleClass("d-none", true);
                        }
                    }
                });

            });
            reader.readAsText(myFile);
            $.notify("File loaded.", "success");
        }
    });



    //Other




    //Replace the values in the rawInput textarea.
    //This textarea holds the data we will provide when saving the file.
    function replaceHandlingAttr(attr, attrName, newValue) {
        var reg = new RegExp('(' + attr + ' ' + attrName + '=")+[a-z.0-9-]*(")', "i");
        if (rawInput.value != null) rawInput.value = rawInput.value.replace(reg, attr + ' ' + attrName + '="' + newValue + '"')
    }

    //Applies the change to the array, and looks for its html counterpart (Slider/Input). 
    //Also applies a the change to them, to keep parity.
    function applyValueChange(e, type) {

        if (type == null) type = "value";
        if (rawInput.value.length < 1000) {
            $("#wEmptyFile").toggleClass("d-none", false);
            return;
        }
        else {
            $("#wEmptyFile").toggleClass("d-none", true);
        }
		
		elementName = e.name;
		if (elementName.indexOf("__") > -1) {
			elementName = elementName.split("__")[0];
		}
        replaceHandlingAttr(elementName, type, e.value);
        handlingArray.handling["" + elementName] = e.value;
        if (e.id == e.name + "Input") {

            var input = document.getElementById(e.name + "Slider");
            input.value = e.value;
        }
        else {
            var input = document.getElementById(e.name + "Input");
            input.value = e.value;
        }
        updateArrayPre();
        UpdateCharts();
        UpdateExplanations(e);
    }
    function UpdateExplanations(e) {


        var expl = document.getElementById(e.name + "Expl");
        if (expl != null) {
            if (e.name == "fClutchChangeRateScaleUpShift") {
                expl.innerHTML = Math.round((1 / e.value) * 1000) / 1000;
            }
            if (e.name == "fDriveInertia") {
                expl.innerHTML = Math.round((1 / e.value) * 100) / 100;
            }
            if (e.name == "fInitialDriveForce") {
                expl.innerHTML = Math.round((((e.value * gearRatios[1]) * 9.8) / 0.44704) * 100) / 100;
            }
            if (e.name == "fBrakeForce") {
                var decc = (e.value) * 9.8; //ms^2
                expl.innerHTML = Math.round(((60 * 0.44704) / (decc * 4)) * 100) / 100;
            }
            if (e.name == "fBrakeBiasFront") {
                var balance = (e.value);
                var result = Math.round((e.value) * 100) + "% Front - " + Math.round((1 - e.value) * 100) + "% Rear";

                expl.innerHTML = result;
            }
            if (e.name == "fTractionBiasFront") {
                var balance = (e.value);
                var grip = handlingArray.handling.fTractionCurveMax;
                var gripFront = Math.round((grip * e.value) * 100) / 100;
                var gripRear = Math.round((grip * (1 - e.value)) * 100) / 100;
                var result = gripFront + "G 前轮 <br> " + gripRear + "G 后轮";

                expl.innerHTML = result;
            }

            if (e.name == "fDownforceModifier") {
                expl.innerHTML = GetDownforceGs(60 * 1.609344, e.value);// Math.round((((Math.sqrt(27)) * e.value) * 0.01) * 100) / 100;
            }
            if (e.name == "fInitialDragCoeff") {
                expl.innerHTML = GetDragCoeffGs(53, e.value);
            }
            if (e.name == "fInitialDriveMaxFlatVel") {
                expl.innerHTML = Math.round((e.value / 0.75 * 0.6213712) * 100) / 100;
            }


        }


        if (1 == 1) {
            if (handlingArray.handling.fInitialDriveForce) {
                var power = handlingArray.handling.fInitialDriveForce;
                var topspeed = (handlingArray.handling.fInitialDriveMaxFlatVel / 0.75) / 3.6; //to m/s halved
                var drag = handlingArray.handling.fInitialDragCoeff;
                var gearings = gearShiftPoints[handlingArray.handling.nInitialDriveGears];
                var spd = 0;


                //console.log(topspeed +"m/s")
                while (spd < topspeed * 2) {

                    spd += 2;
                    var percent = (spd * 100) / topspeed;


                    var gear = 0;
                    while (percent > gearings[gear]) gear++;




                    var torque = Math.round((power * gearRatios[handlingArray.handling.nInitialDriveGears][gear]) * 1000) / 1000;
                    var dragNow = Math.round(((Math.sqrt(spd / 5) / 100) * drag) * 1000) / 1000;


                    //console.log(spd + " m/s at x" + gear + "º  - torque: " + torque + " drag " + dragNow + "");
                    if (torque < dragNow + 0.01) {
                        //var info = "This car peaks at " + spd + "m/s - " + gear + "/" + gearings.length;
                        var info = Math.round((spd / 0.44704) * 10) / 10;

                        var dragExp = document.getElementById("TopSpeedExpl");
                        if (dragExp != null) dragExp.innerHTML = info;
                        break;
                    }


                    //console.log(gearings.findIndex(percent)+"d");
                }

            }
        }
    }
    function GetDragCoeffGs(ms, mod) {
        return Math.round(Math.exp(ms * (mod * 0.001)) * 1000) / 1000;
    }
    function GetDownforceGs(ms, mod) {

        //Standard
        var speedmod = map(ms, 0, handlingArray.handling.fInitialDriveMaxFlatVel * 0.9, 0, (0.035 * mod));

        if (ms > handlingArray.handling.fInitialDriveMaxFlatVel * 0.9) speedmod = (0.035 * mod);
        var r = speedmod;


        //Minimum
        if (mod <= 1.00) r = 0.035;

        //New Downforce
        if (mod > 100) r = 0.0105;

        return Math.round(r * 4 * 1000) / 1000;
    }
    function map(x, in_min, in_max, out_min, out_max) {

        return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }
    function round(number, decimals = 1) {
        if (decimals <= 0) return Math.round(number);
        else return Math.round(number * (10 * decimals)) / (10 * decimals);
    }
    function updateArrayPre() {
        document.getElementById("handlingArray").innerHTML = JSON.stringify(handlingArray, undefined, 2);
    }
    function UpdateCharts() {

        //Torque Chart
        var power = handlingArray.handling.fInitialDriveForce;
        var gears = handlingArray.handling.nInitialDriveGears;
        for (var i = 1; i < 10; i++) chartPower.data.datasets[0].data[i] = 0;
        for (var i = 0; i < gears; i++) {
            chartPower.data.datasets[0].data[i] = round(((power * gearRatios[handlingArray.handling.nInitialDriveGears][i])), 2);
        }
        var power = comparisonHandlingArray.handling.fInitialDriveForce;
        var gears = comparisonHandlingArray.handling.nInitialDriveGears;
        for (var i = 1; i < 10; i++) chartPower.data.datasets[1].data[i] = 0;
        for (var i = 0; i < gears; i++) {
            chartPower.data.datasets[1].data[i] = round(((power * gearRatios[comparisonHandlingArray.handling.nInitialDriveGears][i])), 2);
        }


        //Drag Chart
        var i = 0;
        while (i < chartAirDrag.data.labels.length) {
            chartAirDrag.data.datasets[0].data[i] = GetDragCoeffGs(chartAirDrag.data.labels[i] * 0.447, handlingArray.handling.fInitialDragCoeff);
            i++;
        }
        var i = 0;
        while (i < chartAirDrag.data.labels.length) {
            chartAirDrag.data.datasets[1].data[i] = GetDragCoeffGs(chartAirDrag.data.labels[i] * 0.447, comparisonHandlingArray.handling.fInitialDragCoeff);
            i++;
        }


        //Downforce
        var i = 0;
        while (i < chartDownforce.data.labels.length) {
            chartDownforce.data.datasets[0].data[i] = GetDownforceGs(chartDownforce.data.labels[i] * 1.609344, handlingArray.handling.fDownforceModifier);
            i++;
        }
        var i = 0;
        while (i < chartDownforce.data.labels.length) {
            chartDownforce.data.datasets[1].data[i] = GetDownforceGs(chartDownforce.data.labels[i] * 1.609344, comparisonHandlingArray.handling.fDownforceModifier);
            i++;
        }


        chartStats.data.datasets[0].data[0] = round(map(handlingArray.handling.fInitialDriveForce, 0.2, 0.45, 0, 250), 1);
        chartStats.data.datasets[0].data[1] = round(map((handlingArray.handling.fInitialDriveMaxFlatVel / 0.75) / 3.6, 36, 80, 0, 250), 1);
        chartStats.data.datasets[0].data[3] = round(map(handlingArray.handling.fTractionCurveMax, 1.6, 2.5, 0, 250), 1);
        chartStats.data.datasets[0].data[2] = round(map(handlingArray.handling.fBrakeForce, 0.4, 0.6, 0, 150), 1);
        chartStats.data.datasets[0].data[4] = round(map(GetDownforceGs(60 * 1.609344, handlingArray.handling.fDownforceModifier), 0.1, 0.28, 0, 150), 2);


        chartStats.data.datasets[1].data[0] = round(map(comparisonHandlingArray.handling.fInitialDriveForce, 0.2, 0.45, 0, 250), 1);
        chartStats.data.datasets[1].data[1] = round(map((comparisonHandlingArray.handling.fInitialDriveMaxFlatVel / 0.75) / 3.6, 36, 80, 0, 250), 1);
        chartStats.data.datasets[1].data[3] = round(map(comparisonHandlingArray.handling.fTractionCurveMax, 1.6, 2.5, 0, 250), 1);
        chartStats.data.datasets[1].data[2] = round(map(comparisonHandlingArray.handling.fBrakeForce, 0.4, 0.6, 0, 150), 1);
        chartStats.data.datasets[1].data[4] = round(map(GetDownforceGs(60 * 1.609344, comparisonHandlingArray.handling.fDownforceModifier), 0.1, 0.28, 0, 150), 2);
        var sum = 0;
        chartStats.data.datasets[0].data.forEach(e => sum += e)
        //sum=chartStats.data.datasets[0].data[1]+chartStats.data.datasets[0].data[0];
        chartPerformanceIndex.data.datasets[0].data[0] = round(sum);
        document.getElementById("currentPrice").innerHTML = round(GetPrice(sum));


        sum = 0;
        chartStats.data.datasets[1].data.forEach(e => sum += e)
        chartPerformanceIndex.data.datasets[1].data[0] = round(sum);
        document.getElementById("compPrice").innerHTML = round(GetPrice(sum));

        chartStats.data.datasets[2] = chartStats.data.datasets[1];

        chartPower.update();
        chartAirDrag.update();
        chartDownforce.update();
        chartStats.update();
        chartPerformanceIndex.update();
    }

    function GetPrice(s) {
        if (s > 800) return map(s, 800, 1000, 500000, 1000000);
        if (s > 600) return map(s, 600, 800, 200000, 500000);
        if (s > 400) return map(s, 400, 600, 50000, 200000);
        if (s > 200) return map(s, 200, 400, 10000, 50000);
        if (s > 0) return map(s, 0, 200, 1000, 10000);
    }

    var ctxDownforce = document.getElementById('downforceChart').getContext('2d');
    var chartDownforce = new Chart(ctxDownforce, {
        type: 'line',
        data: {
            labels: [0, 50, 100, 150, 200],
            datasets: [{

                label: '当前车辆',
                fill: false,
                data: [0, 1.5, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',

                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',

                ],
                borderWidth: 1,
                lineTension: 0.15,
            },
            {
                label: '对比车辆',
                fill: false,
                data: [0, 1, 2],
                backgroundColor: [

                    'rgba(54, 162, 235, 0.2)',
                ],
                borderColor: [

                    'rgba(54, 162, 235, 1)',
                ],
                borderWidth: 1,
                lineTension: 0.25,
            }],
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {

                        beginAtZero: true,
                        min: 0
                    },
                    scaleLabel: {
                        display: true,
                        labelString: '额外 G 力'
                    }
                },],
                xAxes: [
                    {

                        scaleLabel: {
                            display: true,
                            labelString: '英里每小时'
                        }
                    }
                ]
            },
        },
    });

    var ctxAirDrag = document.getElementById('airdragChart').getContext('2d');
    var chartAirDrag = new Chart(ctxAirDrag, {
        type: 'line',

        data: {
            labels: [0, 25, 50, 75, 100, 125, 150, 175, 200],
            datasets: [
                {
                    label: '当前车辆',
                    fill: false,
                    data: [0.9, 1, 1.2, 1.3, 1.4, 1.6, 1.8, 2, 2.2],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',

                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',

                    ],
                    borderWidth: 1,
                    lineTension: 0.25,
                },
                {
                    label: '对比车辆',
                    fill: false,
                    data: [0.9, 1, 1.2, 1.3, 1.4, 1.6, 1.8, 2, 2.2],
                    backgroundColor: [

                        'rgba(54, 162, 235, 0.2)',
                    ],
                    borderColor: [

                        'rgba(54, 162, 235, 1)',
                    ],
                    borderWidth: 1,
                    lineTension: 0.25,
                },
            /*
                {
                label: 'x1',
                fill: false,
                data: [0.9, 1, 1.2, 1.3, 1.4, 1.6, 1.8, 2, 2.2],
                backgroundColor: [
                    'rgba(255, 99, 132, 0)',

                ],
                borderColor: [
                    'skyblue',
                ],
                borderWidth: 1,
                lineTension: 0.25,
            },
            {
                label: 'x5',
                fill: false,
                data: [0.9, 1.1, 1.2, 1.4, 1.7, 2, 2.26, 2.65, 2.9],
                backgroundColor: [
                    'rgba(255, 99, 132, 0)',

                ],
                borderColor: [
                    'skyblue',

                ],
                borderWidth: 1,
                lineTension: 0.25,
            },
            {
                label: 'x10',
                fill: false,
                data: [0.9, 1.15, 1.46, 1.78, 2.225, 3.00, 3.7, 4.5, 5.4],
                backgroundColor: [
                    'rgba(255, 99, 132, 0)',

                ],
                borderColor: [
                    'skyblue',

                ],
                borderWidth: 1,
                lineTension: 0.25,
            },
            {
                label: 'x50',
                fill: false,
                data: [1, 1.1, 1.74, 2.5, 3.4, 4.7, 6.3, 8, 9.9],
                backgroundColor: [
                    'rgba(255, 99, 132, 0)',

                ],
                borderColor: [
                    'skyblue',

                ],
                borderWidth: 1,
                lineTension: 0.25,
            }
            */],
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,

                        min: 0
                    },

                    scaleLabel: {
                        display: true,
                        labelString: '空气阻力 (G 力)'
                    }
                },],
                xAxes: [
                    {

                        scaleLabel: {
                            display: true,
                            labelString: '英里每小时'
                        }
                    }
                ]
            },
        },
    });

    var gearRatios =
    {
        1: [0.9], 2: [3.33, 0.9], 3: [3.33, 1.565, 0.9], 4: [3.33, 1.826, 1.222, 0.9], 5: [3.33, 1.934, 1.358, 1.054, 0.9], 6: [3.333, 1.949, 1.392, 1.095, 0.946, 0.9]
    }

    var gearShiftPoints =
    {
        0: [0], 1: [100], 2: [100], 3: [100], 4: [0, 22, 47, 69], 5: [0, 22, 45, 62, 79], 6: [0, 22, 45, 60, 76, 88], 7: [0, 22, 45, 60, 78, 91, 96], 8: [0, 22, 45, 64, 83, 98, 105, 105]
    }
    var ctxPower = document.getElementById('powerChart').getContext('2d');
    var chartPower = new Chart(ctxPower, {
        type: 'line',

        data: {
            labels: ["1º", "2º", "3º", "4º", "5º", "6º", "7º", "8º", "9º", "10º"],

            datasets: [{
                steppedLine: true,
                label: '当前车辆',
                fill: false,
                data: [0.2 * gearRatios[1], 0.2 * gearRatios[2], 0.2 * gearRatios[3], 0.2 * gearRatios[4], 0.2 * gearRatios[5], 0.2 * gearRatios[6],],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',

                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',

                ],
                borderWidth: 1,
                lineTension: 0,
            },
            {
                steppedLine: true,
                label: '对比车辆',
                fill: false,
                data: [0.2 * gearRatios[1], 0.2 * gearRatios[2], 0.2 * gearRatios[3], 0.2 * gearRatios[4], 0.2 * gearRatios[5], 0.2 * gearRatios[6],],
                backgroundColor: [
                    'rgba(54, 162, 235, 0.2)',

                ],
                borderColor: [
                    'rgba(54, 162, 235, 1)',
                ],
                borderWidth: 1,
                lineTension: 0,
            }],

        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        min: 0
                    },
                    scaleLabel: {
                        display: true,
                        labelString: 'Gs'
                    }
                },],
                xAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: '档位'
                    }
                }]
            },
        },
    });

    var ctxStats = document.getElementById('statsChart').getContext('2d');
    var chartStats = new Chart(ctxStats, {
        type: 'horizontalBar',

        data: {
            labels: ["动力", "速度", "刹车", "抓地", "气动"],

            datasets: [{
                label: '当前车辆',
                data: [5, 5, 5, 5, 5],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)', 'rgba(255, 99, 132, 0.2)', 'rgba(255, 99, 132, 0.2)', 'rgba(255, 99, 132, 0.2)', 'rgba(255, 99, 132, 0.2)',
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 99, 132, 1)',
                ],
                borderWidth: 1,

            }, {
                label: '对比车辆',
                data: [5, 5, 5, 5, 5],
                backgroundColor: [
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(54, 162, 235, 0.2)',

                ],
                borderColor: [
                    'rgba(54, 162, 235, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(54, 162, 235, 1)',

                ],

                borderWidth: 1,
            }],

        },
        options: {
            scales: {
                yAxes: [{

                    scaleLabel: {
                        display: false,
                        labelString: ''
                    }
                },],
                xAxes: [{
                    scaleLabel: {
                        display: false,
                        labelString: ''
                    },
                    ticks: {
                        max: 200,
                        min: 0,
                        stepSize: 25

                    },
                }]
            },
        },
    });


    var ctxPerformanceIndex = document.getElementById('piChart').getContext('2d');
    var chartPerformanceIndex = new Chart(ctxPerformanceIndex, {
        type: 'horizontalBar',
        data: {
            labels: ["性能分"],

            datasets: [{
                label: '当前车辆',
                data: [5],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                ],
                borderWidth: 1,

            }, {
                label: '对比车辆',
                data: [5],
                backgroundColor: [
                    'rgba(54, 162, 235, 0.2)',
                ],
                borderColor: [
                    'rgba(54, 162, 235, 1)',
                ],
                borderWidth: 1,
            }],

        },
        options: {
            scales: {
                yAxes: [{

                    scaleLabel: {
                        display: false,
                        labelString: ''
                    }
                },],
                xAxes: [{
                    scaleLabel: {
                        display: false,
                        labelString: ''
                    },
                    ticks: {
                        max: 1000,
                        min: 0,
                        stepSize: 200

                    },
                }]
            },
        },
    });
    /*
        slider.oninput = function() {
            var shiftTime = this.value / 100;
            displayValue.innerHTML = shiftTime;

            realValue.innerHTML = Math.round((1 / shiftTime) * 10000) / 10000;
        }
        function map(x, in_min, in_max, out_min, out_max) {
            return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
        }
        */

    parser = new DOMParser();
    xmlDoc = parser.parseFromString(rawInput.value, "text/xml");
    xmlDoc.getElementsByTagName("Item")[0].childNodes.forEach(element => {
        if (element.attributes) {
            var d = element.attributes[0];
            if (d != null) {
                var sld = document.getElementById(element.nodeName + "Slider");
                if (sld != null) sld.value = d.value;
                var input = document.getElementById(element.nodeName + "Input");
                if (input != null) {
                    input.value = d.value;
                    UpdateExplanations(input);
                }
                handlingArray.handling[element.nodeName] = d.value;
                comparisonHandlingArray.handling[element.nodeName] = d.value;

                UpdateCharts();
                $("#wEmptyFile").toggleClass("d-none", true);
            }
        }
    });




    UpdateCharts();

    $(".custom-file-input").on("change", function () {
        var fileName = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });



    //Mass Comparer

    var allowedHandlingValues = ["handlingName", "fInitialDriveForce", "nInitialDriveGears", "fInitialDriveMaxFlatVel", "fInitialDragCoeff", "fBrakeForce", "fTractionCurveMax", "fDownforceModifier"]

    //Comparison file load,
    var input = document.getElementById("masscomparerloader");
    var tableArr = [];

    var filesLoaded = 0;
    var filesToLoad
    input.addEventListener("change", function () {
        if (this.files && this.files[0]) {


            setTimeout(function () { refillTable(); }, 1000);

            var line = 0;
            tableArr = []

            console.log("Starting process");

            for (var i = 0; i < this.files.length; i++) {


                var myFile = this.files[i];
                var reader = new FileReader();



                reader.addEventListener('load', function (e) {

                    console.log("Loading file");

                    //Parse the document. Copy all values in the document on to the sliders/inputs in the page
                    parser = new DOMParser();
                    xmlDoc = parser.parseFromString(e.target.result, "text/xml");
                    var doc = xmlDoc.getElementsByTagName("Item")[0];


                    for (let index = 0; index < xmlDoc.getElementsByTagName("Item").length; index++) {
                        var item = xmlDoc.getElementsByTagName("Item")[index];
                        if (item.getElementsByTagName("handlingName").length > 0) {
                            var row = 0;
                            tableArr[line] = [];

                            for (i = 0; i < allowedHandlingValues.length; i++) {
                                tableArr[line][i] = "-";
                            }

                            item.childNodes.forEach(element => {
                                if (allowedHandlingValues.includes(element.tagName)) {
                                    if (element.attributes && element.attributes[0]) {
                                        tableArr[line][allowedHandlingValues.indexOf(element.tagName)] = parseFloat(element.attributes[0].value).toFixed(3);
                                    }
                                    else {
                                        tableArr[line][allowedHandlingValues.indexOf(element.tagName)] = element.innerHTML;
                                    }
                                }
                            });
                            console.log("Line nº" + line)
                            line++;
                        }
                    }


                    $.notify("File loaded.", "success");
                    console.log("Loaded file");
                    console.log(tableArr)

                });
                reader.readAsText(myFile);
            }
        }

    });

    function refillTable() {



        //Empty original
        let table = document.getElementById("tbodycompare");
        table.innerHTML = null;
        //Pass from array to table
        for (let row of tableArr) {
            table.insertRow();
            for (let cell of row) {
                let newCell = table.rows[table.rows.length - 1].insertCell();
                newCell.textContent = cell;
            }
        }
    }
    function filterComparerTable(item) {

        refillTable();
        // Declare variables
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase().split(',');
        table = document.getElementById("tbodycompare");
        tr = table.getElementsByTagName("tr");


        // Loop through all table rows, and hide those who don't match the search query
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (filter.includes(txtValue.toUpperCase()) || input.value.length == 0) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }

        var moreToDelete = true;
        while (moreToDelete) {
            moreToDelete = false;
            for (i = 0; i < tr.length; i++) {
                if (tr[i].style.display == 'none') {
                    table.deleteRow(i);
                    moreToDelete = true;
                    break;
                }

            }
        }
    }

    function sortTable(n) {
        
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("tbodycompare");
        switching = true;

        var d = new Date();
       var sStarted=d.getMilliseconds();


        //Set the sorting direction to ascending:
        dir = "asc";


        $("#tablecompare").toggleClass("text-muted", true);

        /*Make a loop that will continue until
        no switching has been done:*/

        while (switching) {


            //start by saying: no switching is done:
            switching = false;

            rows = table.rows;


            /*Loop through all table rows (except the
            first, which contains table headers):*/
            for (i = 0; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;

                /*Get the two elements you want to compare,
                one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];

                /*check if the two rows should switch place,
                based on the direction, asc or desc:*/
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /*If a switch has been marked, make the switch
                and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);

                switching = true;

                //Each time a switch is done, increase this count by 1:
                switchcount++;

                var td = new Date();
                if (td.getMilliseconds() > sStarted+2500 ||td.getMilliseconds()<sStarted) {
                    
                    setTimeout(function () { sortTable(n); }, 0);
                    return;
                }
            } else {
                /*If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again.*/
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
        $("#tablecompare").toggleClass("text-muted", false);
    }
</script>

</html>